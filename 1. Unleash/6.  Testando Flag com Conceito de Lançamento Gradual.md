# Resumo da Aula: Configuração e Uso de Variantes no Unleash

## Introdução
Nesta aula, o professor explora o conceito de **variantes** no Unleash, um recurso do **Gradual Rollout** que permite controlar diferentes versões de uma funcionalidade dentro de uma Feature Flag. O foco é configurar variantes na flag `login_page`, testá-las na aplicação Node.js e demonstrar como elas podem ser usadas para testes A/B ou personalização de features (ex.: labels diferentes em um front-end). A aula também aborda a ativação de **Impression Data** para monitoramento de métricas e prepara para a criação de um Docker Compose na próxima aula.

## Conteúdo Principal

### O que são Variantes?
- **Definição**: Variantes são subconfigurações dentro de uma Feature Flag que permitem definir diferentes versões de uma funcionalidade. Cada variante tem um nome e um valor (payload), que pode ser uma string, número, JSON, ou até um texto específico (ex.: "logar" ou "entrar").
- **Uso**: Podem ser usadas para testes A/B (ex.: comparar dois layouts) ou para personalizar a exibição de uma funcionalidade no front-end (ex.: diferentes labels para um botão).
- **Configuração**:
  - No Unleash, o professor adiciona duas variantes à flag `login_page` no modo **Gradual Rollout** (50% de ativação):
    - Variante A: Nome "A", valor "logar".
    - Variante B: Nome "B", valor "entrar".
  - O peso de cada variante é configurado como 50% (50% dos usuários ativos verão "logar", 50% verão "entrar"). Os pesos são ajustáveis (ex.: 75% para A, 25% para B), mas a soma deve ser 100%.

### Testes com Variantes na Aplicação
- **Código Node.js**:
  - A função `unleash.getVariant('login_page')` é adicionada ao código para recuperar a variante ativa quando a flag está habilitada.
  - O resultado inclui `variant.name` (ex.: "A" ou "B") e `variant.payload.value` (ex.: "logar" ou "entrar").
  - Para melhorar a performance, o professor sugere verificar `unleash.isEnabled` antes de chamar `getVariant`, evitando requisições desnecessárias quando a flag está desativada.
- **Comportamento**:
  - Com a flag desativada, `isEnabled` retorna `false`, e nenhuma variante é retornada.
  - Com a flag ativada (50% rollout), as requisições alternam entre `false` (50% dos casos) e `true` (50% dos casos). Quando `true`, a variante retornada é "A" (logar) ou "B" (entrar), com distribuição 50/50 entre as variantes.
  - O professor corrige um erro inicial onde a flag estava desativada, garantindo que as variantes sejam exibidas apenas quando a flag está ativa.
- **Validação**:
  - O código é ajustado para exibir `variant.name` e `variant.payload.value` apenas se `variant.enabled` for `true`, evitando erros quando a flag está desativada (retorna `disabled`).

### Impression Data e Métricas
- **Impression Data**: Habilitado na flag `login_page` para coletar métricas sobre as requisições. Quando ativado, o Unleash registra eventos relacionados à flag, visíveis no **Event Log**.
- **Event Log**: Registra ações como ativação/desativação da flag e alterações nas variantes, incluindo quem fez a mudança (ex.: usuário admin).
- **Monitoramento**: As métricas não são em tempo real, mas permitem acompanhar o desempenho da flag (ex.: quantas vezes cada variante foi retornada), útil para avaliar taxas de conversão em cenários como cliques em botões no front-end.

### Boas Práticas
- **Organização do Código**: Verificar `isEnabled` antes de `getVariant` reduz chamadas desnecessárias, melhorando a performance.
- **Payload das Variantes**: O valor da variante pode ser um dado complexo (ex.: JSON) ou simples (ex.: string "logar"). Para front-end, pode conter labels ou configurações específicas; para back-end, pode definir comportamentos diferentes.
- **Métricas no Front-end**: Em aplicações reais, é recomendado emitir métricas (ex.: via Segment) para rastrear o impacto das variantes (ex.: taxa de cliques por variante).

### Próximos Passos
- A próxima aula criará um **Docker Compose** para simplificar a configuração do Unleash e do PostgreSQL, além de explorar um exemplo adicional com variáveis customizadas, complementando os testes com constraints e variantes.

## Conclusão
A aula demonstra como configurar e usar **variantes** no Unleash para controlar diferentes versões de uma funcionalidade, com testes práticos na aplicação Node.js. A integração de `getVariant` permite personalizar a exibição de features, enquanto o **Impression Data** e o **Event Log** oferecem monitoramento detalhado. A abordagem reforça a flexibilidade do Unleash para testes A/B e personalização, com boas práticas para otimização e organização do código. A aula prepara o aluno para consolidar a configuração do ambiente com Docker Compose e explorar mais cenários práticos na sequência.